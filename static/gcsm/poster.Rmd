---
title: Application of A Fuzzy Set to the Structural Similarity (SSIM) Index For Assessment of Spatial Association Between Ecological Variables
author: "Yadong Liu^1^, Kwang Soo Kim^1,2^, Cheryl H. Porter^3^"
institute: "1. Department of Plant Science, Seoul National University; 2. Research Institute of Agriculture and Life Sciences, Seoul National University; 3. Department of Agricultural and Biological Engineering, University of Florida"
output:
  pagedown::poster_jacobs:
    self_contained: false
    pandoc_args: --mathjax
bibliography: literature.bib
css: css.css
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warnings=FALSE)
library(tidyverse)
library(latex2exp)
```


# Objective {.block}

The objective of this study was to develop an approach for assessing spatial association by applying fuzzy sets [@mendel2017] to the calculation of the SSIM index. The type-1 fuzzy sets were used to transform the variables to the scale of 0-1. The uncertainty of the ecological data was represented with the interval type-2 fuzzy sets. These approaches would facilitate the evaluation of the spatial association between the ecological variables.

# Introduction

Map comparison is often needed for evaluating spatial models in ecological studies. The SSIM index [@wang2004] originally developed for image quality assessment have been suggested as a diagnostic tool for spatial modeling and analysis [@robertson2014; @jones2016b]. It has advantages to evaluate the association compared to single measures because it can measure the agreement between variables in terms of their central tendencies, variabilities, and the correlation.

However, the SSIM index requires the variables being compared would have the same sign and the same range of values. It is not unusual for ecological variables having different signs and considerable difference in the ranges, e.g. temperature and solar radiation. Thus, some transformation of the data is needed to apply the SSIM index for association assessment.

# SSIM index

SSIM index is defined to compare their means, standard deviations, and capture the correlation coefficient between variables.

$$SSIM(x, y)=l(x, y) \cdot c(x, y) \cdot s(x,y)$$

$$l(x, y)=\frac{2 \mu_{x} \mu_{y}+C_{1}}{\mu_{x}^{2}+\mu_{y}^{2}+C_{1}}$$

$$c(x, y)=\frac{2 \sigma_{x} \sigma_{y}+C_{2}}{\sigma_{x}^{2}+\sigma_{y}^{2}+C_{2}}$$

$$s(x, y)=\frac{\sigma_{x y}+C_{3}}{\sigma_{x} \sigma_{y}+C_{3}}$$

The SSIM index ranges from -1 to 1. It gets maximum of 1 if and only if $x=y$.

# Fuzzy sets

$$\mu_{A}(x)=\left\{\begin{array}{ll}{0} & {\text { if } x<x_{\min }} \\ {1} & {\text { if } x>x_{\max }} \\ {\frac{x-x_{\min }}{x_{\max }-x_{\min }}} & {\text { otherwise }}\end{array}\right.$$

```{r, out.width='100%',fig.cap='The type-1 membership function for temperature'}
tlims <- c(-52.31, 29.85)
ftype1 <- function(x,lims){
  m <- (x-min(lims))/diff(lims)
  m[m<0] <- 0; m[m>1] <- 1
  return(m)
}
ftavg <- tibble(x=seq(tlims[1]-10.5,tlims[2]+10.5,length.out=1001)) %>% 
  mutate(type1=ftype1(x,lims=tlims), Upper=type1^(1/2), Lower=type1^2)

plottype1 <- function(df,xlab,ylab){
  df %>% 
    ggplot()+aes(x,type1)+
    geom_line()+
    xlab(xlab)+ylab(ylab)+
    coord_cartesian(expand=F)+
    theme_classic(base_size=14)
}
plottype1(ftavg,'Temperature (Â°C)','Membership grade')
```

# Usage example

```{r, out.width='80%',fig.cap='The map of (a) Fuzzy SSIM between solar radiation and temperature data, which is the product of (b) s~1~ and (c) s~2~. Solar radiation and temperature data are obtained from the WorldClim dataset.'}
knitr::include_graphics('fssimpy-1.png')
```


# Sensitivity test

```{r,fig.show='hold',out.width='100%',fig.cap='Similarity measures of Fuzzy SSIM, Kendall\'s tau, and Spearman\'s rho between the reference and distortion adding Gaussian noise'}
sens_std <- read_csv('sens_std_ssim.csv')
sens_frac <- read_csv('sens_frac_ssim.csv')
plotsens <- function(df,x,xlab){
  df %>% 
    rename("Fuzzy SSIM"=type1,"Kendall's tau"=tau,"Spearman's rho"=rho) %>% 
    gather(metrics,value,4,6:7) %>% 
    ggplot()+aes({{x}},value,color=metrics)+
    geom_point()+geom_line()+
    xlab(xlab)+ylab('Measures')+
    theme_bw(base_size=14)+
    theme(legend.title=element_blank())+
    theme(legend.position=c(0.85,0.3))
}
plotsens(sens_std,std,xlab='Standard deviation of noise')
plotsens(sens_frac,frac*100,xlab='Number of distorted cells (%)')
```


```{r,eval=F,out.width='100%',fig.cap='Similarity measures of Fuzzy SSIM, Kendall\'s tau, and Spearman\'s rho between the reference and distortion by adding Gaussian noise'}
sens_std <- read_csv('sens_std_ssim.csv')
sens_std %>% select(-gwrsq) %>% 
  rename("Fuzzy SSIM"=type1,"Kendall's tau"=tau,"Spearman's rho"=rho) %>% 
  gather(metrics,value,4,6:7) %>% 
  ggplot()+aes(std,value,color=metrics)+
  geom_point()+geom_line()+
  xlab('Standard deviation of noise')+ylab('Measures')+
  theme_bw(14)+
  theme(legend.title=element_blank())+
  theme(legend.position=c(0.15,0.2))
```


# Conclusion

The SSIM index between fuzzified values would be useful to evaluate spatial relationships between two ecological variables. The fuzzy sets could eliminate the scale inequality while maintaining the relative association, and make it feasible to determine the SSIM index between two maps of ecological variables.

# References
